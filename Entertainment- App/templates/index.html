<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood-Based Movie Recommender</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1>ðŸŽ¬ Mood-Based Movie Recommender ðŸŽ­</h1>
    </header>

    <section class="trending">
        <h2>ðŸ”¥ Trending Movies</h2>
        <div class="movie-grid">
            {% for movie in trending_movies %}
                <div class="movie-card">{{ movie }}</div>
            {% endfor %}
        </div>
    </section>

    <section class="mood-selection">
        <h2>ðŸŽ­ Select Your Mood</h2>
        <select id="mood">
            <option value="Happy">ðŸ˜„ Happy</option>
            <option value="Sad">ðŸ˜¢ Sad</option>
            <option value="Exciting">ðŸ”¥ Exciting</option>
            <option value="Relaxed">ðŸ§˜ Relaxed</option>
            <option value="Fear">ðŸ‘» Fear</option>
            <option value="Fantasy">ðŸ§™ Fantasy</option>
        </select>
        <button onclick="getRecommendations()">ðŸŽ¥ Recommend</button>
        <ul id="recommendations"></ul>
    </section>

   
    <section class="charts">
        <h2>ðŸ“Š Genre Distribution</h2>
        <div class="chart-container">
            <div>
                <canvas id="doughnutChart"></canvas>
            </div>
            <div>
                <canvas id="pieChart"></canvas>
            </div>
        </div>
    </section>
    

    <script>
        function getRecommendations() {
            const mood = document.getElementById('mood').value;
            fetch('/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mood })
            })
            .then(res => res.json())
            .then(data => {
                let list = document.getElementById('recommendations');
                list.innerHTML = data.error ? `<li>${data.error}</li>` : data.recommended.map(m => `<li>${m}</li>`).join('');
                updateGenreCharts(mood);
            });
        }

        function updateGenreCharts(mood) {
            fetch(`/genre-distribution?mood=${mood}`)
            .then(res => res.json())
            .then(data => {
                if (data.error) return;

                let labels = Object.keys(data.genre_distribution);
                let values = Object.values(data.genre_distribution);
                let colors = labels.map(() => `#${Math.floor(Math.random()*16777215).toString(16)}`);

                const chartConfigs = [
                    { id: 'doughnutChart', type: 'doughnut' },
                    { id: 'pieChart', type: 'pie' }
                ];

                chartConfigs.forEach(({ id, type }) => {
                    new Chart(document.getElementById(id), {
                        type,
                        data: { labels, datasets: [{ data: values, backgroundColor: colors }] },
                        options: { responsive: true, plugins: { legend: { position: 'top' } } }
                    });
                });
            });
        }
    </script>
</body>
</html>
